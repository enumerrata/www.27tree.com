<?xml version="1.0" encoding="UTF-8"?>
<root>
<title>cURL抓取网页 POST数据及其他功能介绍</title>
<content>&amp;lt;p&amp;gt;
	使用PHP的cURL库可以简单和有效地去抓网页。你只需要运行一个脚本，然后分析一下你所抓取的网页，然后就可以以程序的方式得到你想要的数据了。无论是你想从从一个链接上取部分数据，或是取一个XML文件并把其导入数据库，那怕就是简单的获取网页内容，cURL&amp;nbsp;是一个功能强大的PHP库。本文主要讲述如果使用这个PHP库。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	启用&amp;nbsp;cURL&amp;nbsp;设置
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	首先，我们得先要确定我们的PHP是否开启了这个库，你可以通过使用php_info()函数来得到这一信息。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	&amp;amp;lt;?php
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	phpinfo();
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	?&amp;amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	如果你可以在网页上看到下面的输出，那么表示cURL库已被开启。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	如果你看到的话，那么你需要设置你的PHP并开启这个库。如果你是在Windows平台下，那么非常简单，你需要改一改你的php.ini文件的设置，找到php_curl.dll，并取消前面的分号注释就行了。如下所示：
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//取消下在的注释
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	extension=php_curl.dll
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	如果你是在Linux下面，那么，你需要重新编译你的PHP了，编辑时，你需要打开编译参数——在configure命令上加上“–with-curl”&amp;nbsp;参数。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	一个小示例
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	如果一切就绪，下面是一个小例程：
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	&amp;amp;lt;?php
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;初始化一个&amp;nbsp;cURL&amp;nbsp;对象
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$curl&amp;nbsp;=&amp;nbsp;curl_init();
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;设置你需要抓取的URL
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($curl,&amp;nbsp;CURLOPT_URL,&amp;nbsp;&amp;nbsp;http://cocre.com&amp;nbsp;);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;设置header
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($curl,&amp;nbsp;CURLOPT_HEADER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;设置cURL&amp;nbsp;参数，要求结果保存到字符串中还是输出到屏幕上。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($curl,&amp;nbsp;CURLOPT_RETURNTRANSFER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;运行cURL，请求网页
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$data&amp;nbsp;=&amp;nbsp;curl_exec($curl);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;关闭URL请求
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_close($curl);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	//&amp;nbsp;显示获得的数据
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	var_dump($data);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	?&amp;amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	如何POST数据
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	上面是抓取网页的代码，下面则是向某个网页POST数据。假设我们有一个处理表单的网址http://www.example.com/sendSMS.php，其可以接受两个表单域，一个是电话号码，一个是短信内容。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	&amp;amp;lt;?php
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$phoneNumber&amp;nbsp;=&amp;nbsp;&amp;nbsp;13912345678&amp;nbsp;;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$message&amp;nbsp;=&amp;nbsp;&amp;nbsp;This&amp;nbsp;message&amp;nbsp;was&amp;nbsp;generated&amp;nbsp;by&amp;nbsp;curl&amp;nbsp;and&amp;nbsp;php&amp;nbsp;;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$curlPost&amp;nbsp;=&amp;nbsp;&amp;nbsp;pNUMBER=&amp;nbsp;&amp;nbsp;.&amp;nbsp;urlencode($phoneNumber)&amp;nbsp;.&amp;nbsp;&amp;nbsp;&amp;amp;MESSAGE=&amp;nbsp;&amp;nbsp;.&amp;nbsp;urlencode($message)&amp;nbsp;.&amp;nbsp;&amp;nbsp;&amp;amp;SUBMIT=Send&amp;nbsp;;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$ch&amp;nbsp;=&amp;nbsp;curl_init();
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_URL,&amp;nbsp;&amp;nbsp;http://www.example.com/sendSMS.php&amp;nbsp;);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_HEADER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_RETURNTRANSFER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_POST,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_POSTFIELDS,&amp;nbsp;$curlPost);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$data&amp;nbsp;=&amp;nbsp;curl_exec();curl_close($ch);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	?&amp;amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	从上面的程序我们可以看到，使用CURLOPT_POST设置HTTP协议的POST方法，而不是GET方法，然后以CURLOPT_POSTFIELDS设置POST的数据。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	关于代理服务器
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	下面是一个如何使用代理服务器的示例。请注意其中高亮的代码，代码很简单，我就不用多说了。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	&amp;amp;lt;?php
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$ch&amp;nbsp;=&amp;nbsp;curl_init();
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_URL,&amp;nbsp;&amp;nbsp;http://www.example.com&amp;nbsp;);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_HEADER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_RETURNTRANSFER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_HTTPPROXYTUNNEL,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_PROXY,&amp;nbsp;&amp;nbsp;fakeproxy.com:1080&amp;nbsp;);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_PROXYUSERPWD,&amp;nbsp;&amp;nbsp;user:password&amp;nbsp;);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$data&amp;nbsp;=&amp;nbsp;curl_exec();curl_close($ch);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	?&amp;amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	关于SSL和Cookie
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	关于SSL也就是HTTPS协议，你只需要把CURLOPT_URL连接中的http://变成https://就可以了。当然，还有一个参数叫CURLOPT_SSL_VERIFYHOST可以设置为验证站点。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	关于Cookie，你需要了解下面三个参数：
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	CURLOPT_COOKIE，在当面的会话中设置一个cookie
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	CURLOPT_COOKIEJAR，当会话结束的时候保存一个Cookie
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	CURLOPT_COOKIEFILE，Cookie的文件。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	HTTP服务器认证
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	最后，我们来看一看HTTP服务器认证的情况。
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	&amp;amp;lt;?php
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$ch&amp;nbsp;=&amp;nbsp;curl_init();
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_URL,&amp;nbsp;&amp;nbsp;http://www.example.com&amp;nbsp;);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_RETURNTRANSFER,&amp;nbsp;1);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt($ch,&amp;nbsp;CURLOPT_HTTPAUTH,&amp;nbsp;CURLAUTH_BASIC);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_setopt(CURLOPT_USERPWD,&amp;nbsp;&amp;nbsp;[username]:[password]&amp;nbsp;)
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	$data&amp;nbsp;=&amp;nbsp;curl_exec();
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	curl_close($ch);
&amp;lt;/p&amp;gt;
&amp;lt;p&amp;gt;
	?&amp;amp;gt;
&amp;lt;/p&amp;gt;</content>
<json-link>./file/php/2012-06-12/1339470358.json</json-link>
<comment-link>4</comment-link>
<tags>5</tags>
<imghref/>
<comment-list>
 <c>
  <author-c>1</author-c>
  <uid-c>2</uid-c>
  <date-c>2</date-c>
  <conf-c>3</conf-c>
  <locked>true</locked>
 </c>
</comment-list>
</root>
